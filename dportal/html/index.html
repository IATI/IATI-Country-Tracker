#html
<!DOCTYPE html> 
<html> 
	<head>
<meta charset="UTF-8">
<title>{welcome_text}</title>
<script src="{root}jslib/jquery.js"></script>
<script src="{root}jslib/chosen.jquery.min.js"></script>
<link  href="{root}art/chosen.min.css" rel="stylesheet" type="text/css" >
<link  href="{root}art/index.css" rel="stylesheet" type="text/css" >
{ganal}
{jsmenu}
	</head> 
<body>
<div class="portal">
	<div class="main_wrap">
		<div id="background_image"></div>
		<div class="overlay">
			<div class="default center">
				<img src="{root}art/dp_logo.index.png" width="600" height="250" alt="D-Portal logo"/>
				<div class="tongue_wrap">{tongue_select}</div>
				<div class="tag">{tagline_text}</div>
				<div class="default pad40">
					<div class="third">
						<a href="http://d-portal.org/ctrack.html#view=generator" class="path">
							<span class="path_title install">{install_button_text}</span>
							<span class="path_txt">{install_info_text}</span>
						</a>
					</div><div class="third">
						<a href="#explore" class="path">
							<span class="path_title explore">{explore_button_text}</span>
							<span class="path_txt">{explore_info_text}</span>
						</a>
					</div><div class="third">
						<a href="https://github.com/devinit/D-Portal" target="_blank" class="path">
							<span class="path_title develop">{develop_button_text}</span>
							<span class="path_txt">{develop_info_text}</span>
						</a>
					</div>
				</div>
				<div class="description_wrap">
					<div class="description">
						<span class="title">{index_title_text}</span>
						<p><span class="bold">d-portal.org</span> {index_paragraph1_text}</p>
						<p>{index_paragraph2_text}</p>
					</div><div class="description">
						<span class="title">{links_title_text}</span>
						<a href="{tongue_root}news/posts.html" class="read">&gt; {news_page_text}</a>
						<a href="{tongue_root}about.html" class="read">&gt; {read_more_text}</a>
						<span class="title">{explore_title_text}</span>
						<p><b>{explore_paragraph1_text}</b>{explore_paragraph2_text}</p>
					</div>
				</div>
				<div class="country_menu_wrap">
					<span id="explore"></span>
<div id="country_dropmenu" style="display:inline-block;"></div>
<div id="publisher_dropmenu" style="display:inline-block;"></div>
					<div class="country_menu_list_wrap">
						<div style="display:inline-block; vertical-align:top; width:460px; padding-right:19px; border-right:1px solid #A0988B;">
							<ul class="country_menu_list">{countries:country_select}</ul>
						</div><div style="display:inline-block; vertical-align:top; padding-left:20px; width:460px;">
							<ul class="country_menu_list">{publishers:publisher_select}</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="footer_wrap">
	<div class="footer">
		<div class="footer_link"><a href="mailto:queries@d-portal.org" title="{footer1_tip_text}">
			{footer1_text}</a>
		</div><div class="footer_link top"><a onclick="$('html,body').animate({scrollTop:0},'slow');return false;">
			{footer2_text}</a>
		</div><div class="footer_link about"><a href="{tongue_root}about.html">
			{footer3_text}</a>
		</div>
	</div>
	</div>
</div>
</body>
</html>

#country_select
<li>
	<a class="country_code" href="{root}ctrack.html?country={it.id}&tongue={tongue}">
		<span class="select_wrap">
			<img src="{root}art/flag/{it.cc}.png" alt="{it.name} {flag_alt_text}"/>
		</span><span class="select_wrap countryid">
			{it.id}
		</span><span class="select_wrap countryname">
			{it.name}
		</span>
	</a>
</li>

#publisher_head
<li>
	<div class="publisher_list">
		<span class="select_wrap publishername">
			Publisher Name
		</span><span class="select_wrap publisherid">
			Publisher ID
		</span>
	</div>
</li>

#publisher_select
<li>
	<a class="country_code" href="{root}ctrack.html?publisher={it.id}&tongue={tongue}">
		<span class="select_wrap publishername">
			{it.name}
		</span><span class="select_wrap publisherid">
			{it.id}
		</span>
	</a>
</li>

#js_country_lookup
"{it.cc}":"{it.name}",
#jsmenu
<script>
	
	(function(){
		var lookup={ {countries:js_country_lookup} };
		var reportings;
		var countries;
		var change=function(){

			var name=""+$("#publisher_dropmenu select").val();
			if(name && (name!=""))
			{
				window.location.href="{root}ctrack.html?publisher="+name+"&tongue={tongue}"
			}

			var name=""+$("#country_dropmenu select").val();
			if(name && (name!=""))
			{
				window.location.href="{root}ctrack.html?country="+name+"&tongue={tongue}"
			}

		};
		var refresh=function(){
			if(reportings)
			{
				var aa=[];
				aa.push("<select>");
				aa.push("<option value=''></option>");
				for(var i=0;i<reportings.rows.length;i++)
				{
					var v=reportings.rows[i];
					var d=v.reporting_ref;
					var t=v.reporting+" ("+v.count+") ";
					var s="<option value='"+d+"'>"+t+"</option>";
					aa.push(s);
				}
				aa.push("</select>");
				$("#publisher_dropmenu").html(aa.join(""));
				
				$("#publisher_dropmenu select").change(change);
				$("#publisher_dropmenu select").chosen({"placeholder_text_single":"Select a publisher"});
			}
			if(countries)
			{
				var aa=[];
				aa.push("<select>");
				aa.push("<option value=''></option>");
				for(var i=0;i<countries.rows.length;i++)
				{
					var v=countries.rows[i];
					var d=v.country_code;
					var t=(lookup[v.country_code.toLowerCase()] || v.country_code )+" ("+v.count+") ";
					var s="<option value='"+d+"'>"+t+"</option>";
					aa.push(s);
				}
				aa.push("</select>");
				$("#country_dropmenu").html(aa.join(""));

				$("#country_dropmenu select").change(change);
				$("#country_dropmenu select").chosen({"placeholder_text_single":"Select a recipient country"});
			}
		};

		(function(){
			var callback=function(dd)
			{
//				console.log("reporting");
//				console.log(dd);
				reportings=dd;
				refresh();
			};
			var dd={};
			dd.groupby="reporting_ref";
			dd.orderby="1-";
			dd.select="count,reporting_ref,reporting";
			dd.limit=-1;
			$.ajax({
			  dataType: "json",
			  url: "/q?callback=?",
			  data: dd,
			  success: callback
			});
		})();

		(function(){
			var callback=function(dd)
			{
//				console.log("country");
//				console.log(dd);
				countries=dd;
				refresh();
			};
			var dd={};
			dd.groupby="country_code";
			dd.orderby="1-";
			dd.select="count,country_code";
			dd.from="act,country";
			dd.limit=-1;
			$.ajax({
			  dataType: "json",
			  url: "/q?callback=?",
			  data: dd,
			  success: callback
			});
		})();
		
	})();

</script>
