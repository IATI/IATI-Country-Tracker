#
# this script checks for changes on the remote git and then performs a git pull and optional build
# recomended to run under a flock like so (but with full paths)
# flock -w0 ./cron ./cron
#

cd `dirname $0`

source settings

git fetch --quiet

if [ $(git rev-parse HEAD) != $(git rev-parse @{u}) ] ; then

#only build with build flag
 if [ $1 = "build" ]; then
  echo "CRON PULL AND BUILD"
#pull and build
  git pull
  ./upgrade
  ./build
#add the newly built files and push
  cd $PLATED_OUTPUT
  git add .
  git commit -m.
  git push
 else
  echo "CRON PULL"
  git pull
  cd $PLATED_OUTPUT
  git pull
 fi
fi
